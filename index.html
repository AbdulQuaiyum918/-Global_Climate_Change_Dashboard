<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Change Dashboard (1980-2019)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .key-finding {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            backdrop-filter: blur(10px);
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
        }

        select, button {
            padding: 8px 16px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:hover, button:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            font-weight: 600;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 400px 400px;
            gap: 20px;
            padding: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .chart-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .chart {
            height: calc(100% - 50px);
        }

        .tooltip {
            position: absolute;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            line-height: 1.6;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tooltip strong {
            color: #ffd700;
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .line {
            fill: none;
            stroke-width: 2.5;
            transition: stroke-width 0.3s, opacity 0.3s;
        }

        .line:hover {
            stroke-width: 4;
        }

        .line.dimmed {
            opacity: 0.2;
        }

        .line.highlighted {
            stroke-width: 4;
            opacity: 1;
        }

        .bar {
            transition: opacity 0.3s, fill 0.3s;
            cursor: pointer;
        }

        .bar:hover {
            opacity: 0.8;
        }

        .bar.dimmed {
            opacity: 0.3;
        }

        .bar.highlighted {
            opacity: 1;
        }

        .scatter-dot {
            transition: r 0.3s, opacity 0.3s;
            cursor: pointer;
        }

        .scatter-dot:hover {
            r: 8;
        }

        .scatter-dot.dimmed {
            opacity: 0.2;
        }

        .scatter-dot.highlighted {
            opacity: 1;
        }

        .country-flag {
            cursor: pointer;
            transition: all 0.3s;
        }

        .country-flag:hover {
            transform: scale(1.2);
        }

        .country-flag.dimmed {
            opacity: 0.3;
        }

        .country-flag.highlighted {
            stroke: #ffd700;
            stroke-width: 3;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            font-size: 12px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 20px;
            height: 12px;
            border-radius: 3px;
        }

        .axis {
            font-size: 12px;
        }

        .axis-label {
            font-size: 13px;
            font-weight: 600;
            fill: #495057;
        }

        .grid line {
            stroke: #e9ecef;
            stroke-dasharray: 2,2;
        }

        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(4, 400px);
            }
        }

        .selected-info {
            background: #fff3cd;
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            font-weight: 600;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç Global Climate Change Dashboard</h1>
            <p>Temperature Trends & CO‚ÇÇ Emissions Analysis (1980-2019)</p>
            <div class="key-finding">
                <strong>Key Finding:</strong> Arctic and high-latitude regions are warming 2-3x faster than the global average, 
                demonstrating that climate impacts are geographically unequal despite emissions being globally mixed.
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Compare Countries:</label>
                <select id="country-selector" multiple style="height: 40px; width: 200px;">
                    <option value="Austria">Austria</option>
                    <option value="United States">United States</option>
                    <option value="India">India</option>
                    <option value="Greenland">Greenland</option>
                    <option value="Norway">Norway</option>
                    <option value="China">China</option>
                    <option value="Germany">Germany</option>
                    <option value="Brazil">Brazil</option>
                </select>
            </div>
            <div class="control-group">
                <label>Region Filter:</label>
                <select id="region-filter">
                    <option value="all">All Regions</option>
                    <option value="arctic">Arctic/High-Latitude</option>
                    <option value="continental">Continental Interior</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <button id="reset-btn">Reset Selection</button>
            <div class="selected-info" id="selected-info" style="display: none;"></div>
        </div>

        <div class="dashboard">
            <div class="chart-container">
                <div class="chart-title">üìà Temperature Trends Over Time</div>
                <div id="timeseries-chart" class="chart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">üèÜ Top Countries by Temperature Increase</div>
                <div id="bar-chart" class="chart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">üåê World Temperature Change Map</div>
                <div id="map-chart" class="chart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">üí® CO‚ÇÇ Emissions vs Temperature Increase</div>
                <div id="scatter-chart" class="chart"></div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // Sample climate data based on your analysis
        const climateData = {
            timeseries: [
                // Austria
                {country: 'Austria', year: 1980, temp: 0.2, region: 'other'},
                {country: 'Austria', year: 1990, temp: 0.5, region: 'other'},
                {country: 'Austria', year: 2000, temp: 0.9, region: 'other'},
                {country: 'Austria', year: 2010, temp: 1.3, region: 'other'},
                {country: 'Austria', year: 2019, temp: 1.6, region: 'other'},
                // United States
                {country: 'United States', year: 1980, temp: 0.3, region: 'other'},
                {country: 'United States', year: 1990, temp: 0.5, region: 'other'},
                {country: 'United States', year: 2000, temp: 0.8, region: 'other'},
                {country: 'United States', year: 2010, temp: 1.0, region: 'other'},
                {country: 'United States', year: 2019, temp: 1.2, region: 'other'},
                // India
                {country: 'India', year: 1980, temp: 0.1, region: 'other'},
                {country: 'India', year: 1990, temp: 0.3, region: 'other'},
                {country: 'India', year: 2000, temp: 0.5, region: 'other'},
                {country: 'India', year: 2010, temp: 0.7, region: 'other'},
                {country: 'India', year: 2019, temp: 0.9, region: 'other'},
                // Greenland
                {country: 'Greenland', year: 1980, temp: 0.4, region: 'arctic'},
                {country: 'Greenland', year: 1990, temp: 0.9, region: 'arctic'},
                {country: 'Greenland', year: 2000, temp: 1.5, region: 'arctic'},
                {country: 'Greenland', year: 2010, temp: 2.2, region: 'arctic'},
                {country: 'Greenland', year: 2019, temp: 2.8, region: 'arctic'},
                // Norway
                {country: 'Norway', year: 1980, temp: 0.3, region: 'arctic'},
                {country: 'Norway', year: 1990, temp: 0.7, region: 'arctic'},
                {country: 'Norway', year: 2000, temp: 1.2, region: 'arctic'},
                {country: 'Norway', year: 2010, temp: 1.7, region: 'arctic'},
                {country: 'Norway', year: 2019, temp: 2.1, region: 'arctic'},
                // China
                {country: 'China', year: 1980, temp: 0.2, region: 'other'},
                {country: 'China', year: 1990, temp: 0.4, region: 'other'},
                {country: 'China', year: 2000, temp: 0.7, region: 'other'},
                {country: 'China', year: 2010, temp: 1.0, region: 'other'},
                {country: 'China', year: 2019, temp: 1.3, region: 'other'},
                // Germany
                {country: 'Germany', year: 1980, temp: 0.2, region: 'other'},
                {country: 'Germany', year: 1990, temp: 0.5, region: 'other'},
                {country: 'Germany', year: 2000, temp: 0.9, region: 'other'},
                {country: 'Germany', year: 2010, temp: 1.2, region: 'other'},
                {country: 'Germany', year: 2019, temp: 1.5, region: 'other'},
                // Brazil
                {country: 'Brazil', year: 1980, temp: 0.1, region: 'other'},
                {country: 'Brazil', year: 1990, temp: 0.3, region: 'other'},
                {country: 'Brazil', year: 2000, temp: 0.5, region: 'other'},
                {country: 'Brazil', year: 2010, temp: 0.7, region: 'other'},
                {country: 'Brazil', year: 2019, temp: 0.8, region: 'other'},
            ],
            summary: [
                {country: 'Greenland', tempIncrease: 2.4, co2: 9.2, population: 56000, region: 'arctic'},
                {country: 'Norway', tempIncrease: 1.8, co2: 8.3, population: 5400000, region: 'arctic'},
                {country: 'Finland', tempIncrease: 1.7, co2: 8.7, population: 5500000, region: 'arctic'},
                {country: 'Mongolia', tempIncrease: 1.6, co2: 7.1, population: 3300000, region: 'continental'},
                {country: 'Austria', tempIncrease: 1.4, co2: 7.8, population: 9000000, region: 'other'},
                {country: 'Kazakhstan', tempIncrease: 1.4, co2: 15.2, population: 18700000, region: 'continental'},
                {country: 'Germany', tempIncrease: 1.3, co2: 9.1, population: 83000000, region: 'other'},
                {country: 'China', tempIncrease: 1.1, co2: 7.4, population: 1400000000, region: 'other'},
                {country: 'United States', tempIncrease: 0.9, co2: 15.5, population: 331000000, region: 'other'},
                {country: 'India', tempIncrease: 0.8, co2: 1.9, population: 1380000000, region: 'other'},
                {country: 'Brazil', tempIncrease: 0.7, co2: 2.2, population: 212000000, region: 'other'},
                {country: 'Australia', tempIncrease: 1.2, co2: 16.8, population: 25600000, region: 'other'},
                {country: 'Canada', tempIncrease: 1.6, co2: 15.4, population: 38000000, region: 'arctic'},
            ]
        };

        // Global state for brushing & linking
        let selectedCountries = new Set();
        let currentRegion = 'all';

        // Color scales
        const regionColors = {
            'arctic': '#C70039',
            'continental': '#F77F00',
            'other': '#2E86AB'
        };

        const countryColors = d3.scaleOrdinal()
            .domain(['Austria', 'United States', 'India', 'Greenland', 'Norway', 'China', 'Germany', 'Brazil'])
            .range(['#D62828', '#2E86AB', '#F77F00', '#C70039', '#06D6A0', '#FFC300', '#9D4EDD', '#06FFA5']);

        // Tooltip
        const tooltip = d3.select('#tooltip');

        function showTooltip(html, event) {
            tooltip.html(html)
                .style('left', (event.pageX + 15) + 'px')
                .style('top', (event.pageY - 15) + 'px')
                .style('opacity', 1);
        }

        function hideTooltip() {
            tooltip.style('opacity', 0);
        }

        // Update selection display
        function updateSelectionInfo() {
            const info = document.getElementById('selected-info');
            if (selectedCountries.size > 0) {
                info.style.display = 'block';
                info.textContent = `Selected: ${Array.from(selectedCountries).join(', ')}`;
            } else {
                info.style.display = 'none';
            }
        }

        // Filter data by region
        function filterByRegion(data, region) {
            if (region === 'all') return data;
            return data.filter(d => d.region === region);
        }

        // Chart 1: Time Series
        function createTimeSeries() {
            const container = d3.select('#timeseries-chart');
            container.selectAll('*').remove();

            const margin = {top: 20, right: 120, bottom: 50, left: 60};
            const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
            const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

            const svg = container.append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Filter data
            let data = climateData.timeseries;
            if (currentRegion !== 'all') {
                data = filterByRegion(data, currentRegion);
            }

            const nested = d3.group(data, d => d.country);

            const x = d3.scaleLinear()
                .domain([1980, 2019])
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.temp)])
                .range([height, 0]);

            // Grid
            svg.append('g')
                .attr('class', 'grid')
                .call(d3.axisLeft(y).tickSize(-width).tickFormat(''));

            // Axes
            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x).tickFormat(d3.format('d')));

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y));

            svg.append('text')
                .attr('class', 'axis-label')
                .attr('transform', 'rotate(-90)')
                .attr('y', -45)
                .attr('x', -height / 2)
                .attr('text-anchor', 'middle')
                .text('Temperature Change (¬∞C)');

            svg.append('text')
                .attr('class', 'axis-label')
                .attr('x', width / 2)
                .attr('y', height + 40)
                .attr('text-anchor', 'middle')
                .text('Year');

            const line = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.temp))
                .curve(d3.curveMonotoneX);

            // Draw lines
            nested.forEach((values, country) => {
                const path = svg.append('path')
                    .datum(values)
                    .attr('class', 'line')
                    .attr('d', line)
                    .attr('stroke', countryColors(country))
                    .attr('data-country', country)
                    .on('mouseover', function(event) {
                        if (selectedCountries.size === 0) {
                            d3.selectAll('.line').classed('dimmed', true);
                            d3.select(this).classed('dimmed', false).classed('highlighted', true);
                        }
                        showTooltip(`<strong>${country}</strong>Trend from ${d3.min(values, d => d.year)} to ${d3.max(values, d => d.year)}`, event);
                    })
                    .on('mouseout', function() {
                        if (selectedCountries.size === 0) {
                            d3.selectAll('.line').classed('dimmed', false).classed('highlighted', false);
                        }
                        hideTooltip();
                    })
                    .on('click', function() {
                        handleCountrySelection(country);
                    });

                // Add label at end
                const lastPoint = values[values.length - 1];
                svg.append('text')
                    .attr('x', x(lastPoint.year) + 5)
                    .attr('y', y(lastPoint.temp))
                    .attr('dy', '0.35em')
                    .attr('font-size', '11px')
                    .attr('fill', countryColors(country))
                    .text(country);
            });

            updateHighlighting();
        }

        // Chart 2: Bar Chart
        function createBarChart() {
            const container = d3.select('#bar-chart');
            container.selectAll('*').remove();

            const margin = {top: 20, right: 30, bottom: 50, left: 120};
            const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
            const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

            const svg = container.append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Filter and sort data
            let data = climateData.summary;
            if (currentRegion !== 'all') {
                data = filterByRegion(data, currentRegion);
            }
            data = data.sort((a, b) => b.tempIncrease - a.tempIncrease).slice(0, 10);

            const x = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.tempIncrease)])
                .range([0, width]);

            const y = d3.scaleBand()
                .domain(data.map(d => d.country))
                .range([0, height])
                .padding(0.2);

            // Axes
            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x));

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y));

            svg.append('text')
                .attr('class', 'axis-label')
                .attr('x', width / 2)
                .attr('y', height + 40)
                .attr('text-anchor', 'middle')
                .text('Temperature Increase (¬∞C)');

            // Bars
            svg.selectAll('.bar')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'bar')
                .attr('data-country', d => d.country)
                .attr('x', 0)
                .attr('y', d => y(d.country))
                .attr('width', d => x(d.tempIncrease))
                .attr('height', y.bandwidth())
                .attr('fill', d => regionColors[d.region])
                .on('mouseover', function(event, d) {
                    if (selectedCountries.size === 0) {
                        d3.selectAll('.bar').classed('dimmed', true);
                        d3.select(this).classed('dimmed', false);
                    }
                    showTooltip(`<strong>${d.country}</strong>
                        Temp Increase: +${d.tempIncrease.toFixed(2)}¬∞C<br>
                        CO‚ÇÇ: ${d.co2.toFixed(1)} tonnes/capita<br>
                        Region: ${d.region}`, event);
                })
                .on('mouseout', function() {
                    if (selectedCountries.size === 0) {
                        d3.selectAll('.bar').classed('dimmed', false);
                    }
                    hideTooltip();
                })
                .on('click', function(event, d) {
                    handleCountrySelection(d.country);
                });

            // Value labels
            svg.selectAll('.bar-label')
                .data(data)
                .enter()
                .append('text')
                .attr('class', 'bar-label')
                .attr('x', d => x(d.tempIncrease) + 5)
                .attr('y', d => y(d.country) + y.bandwidth() / 2)
                .attr('dy', '0.35em')
                .attr('font-size', '11px')
                .attr('fill', '#495057')
                .text(d => `+${d.tempIncrease.toFixed(2)}¬∞C`);

            updateHighlighting();
        }

        // Chart 3: World Map (Simplified)
        function createMap() {
            const container = d3.select('#map-chart');
            container.selectAll('*').remove();

            const margin = {top: 20, right: 20, bottom: 20, left: 20};
            const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
            const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

            const svg = container.append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Simplified representation with country circles
            let data = climateData.summary;
            if (currentRegion !== 'all') {
                data = filterByRegion(data, currentRegion);
            }

            // Position countries in a grid
            const cols = Math.ceil(Math.sqrt(data.length));
            const cellWidth = width / cols;
            const cellHeight = height / Math.ceil(data.length / cols);

            const colorScale = d3.scaleSequential()
                .domain([0, d3.max(data, d => d.tempIncrease)])
                .interpolator(d3.interpolateYlOrRd);

            data.forEach((d, i) => {
                const col = i % cols;
                const row = Math.floor(i / cols);
                const x = col * cellWidth + cellWidth / 2;
                const y = row * cellHeight + cellHeight / 2;

                const g = svg.append('g')
                    .attr('transform', `translate(${x},${y})`);

                g.append('circle')
                    .attr('class', 'country-flag')
                    .attr('data-country', d.country)
                    .attr('r', Math.min(cellWidth, cellHeight) / 3)
                    .attr('fill', colorScale(d.tempIncrease))
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 2)
                    .on('mouseover', function(event) {
                        if (selectedCountries.size === 0) {
                            d3.selectAll('.country-flag').classed('dimmed', true);
                            d3.select(this).classed('dimmed', false);
                        }
                        showTooltip(`<strong>${d.country}</strong>
                            Temp Increase: +${d.tempIncrease.toFixed(2)}¬∞C<br>
                            CO‚ÇÇ: ${d.co2.toFixed(1)} tonnes/capita`, event);
                    })
                    .on('mouseout', function() {
                        if (selectedCountries.size === 0) {
                            d3.selectAll('.country-flag').classed('dimmed', false);
                        }
                        hideTooltip();
                    })
                    .on('click', function() {
                        handleCountrySelection(d.country);
                    });

                g.append('text')
                    .attr('y', Math.min(cellWidth, cellHeight) / 3 + 15)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '10px')
                    .attr('fill', '#495057')
                    .text(d.country.substring(0, 3));
            });

            // Legend
            const legendWidth = 200;
            const legendHeight = 15;
            const legendX = width - legendWidth - 10;
            const legendY = 10;

            const legendScale = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.tempIncrease)])
                .range([0, legendWidth]);

            const legendAxis = d3.axisBottom(legendScale)
                .ticks(5)
                .tickFormat(d => `+${d.toFixed(1)}¬∞C`);

            const defs = svg.append('defs');
            const gradient = defs.append('linearGradient')
                .attr('id', 'temp-gradient');

            gradient.selectAll('stop')
                .data(d3.range(0, 1.1, 0.1))
                .enter()
                .append('stop')
                .attr('offset', d => `${d * 100}%`)
                .attr('stop-color', d => colorScale(d * d3.max(data, d => d.tempIncrease)));

            svg.append('rect')
                .attr('x', legendX)
                .attr('y', legendY)
                .attr('width', legendWidth)
                .attr('height', legendHeight)
                .style('fill', 'url(#temp-gradient)')
                .attr('stroke', '#ccc');

            svg.append('g')
                .attr('transform', `translate(${legendX},${legendY + legendHeight})`)
                .call(legendAxis)
                .select('.domain').remove();

            updateHighlighting();
        }

        // Chart 4: Scatter Plot
        function createScatter() {
            const container = d3.select('#scatter-chart');
            container.selectAll('*').remove();

            const margin = {top: 20, right: 20, bottom: 50, left: 60};
            const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
            const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

            const svg = container.append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            // Filter data
            let data = climateData.summary;
            if (currentRegion !== 'all') {
                data = filterByRegion(data, currentRegion);
            }

            const x = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.co2)])
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.tempIncrease)])
                .range([height, 0]);

            const sizeScale = d3.scaleSqrt()
                .domain([0, d3.max(data, d => d.population)])
                .range([3, 15]);

            // Grid
            svg.append('g')
                .attr('class', 'grid')
                .call(d3.axisLeft(y).tickSize(-width).tickFormat(''));

            svg.append('g')
                .attr('class', 'grid')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x).tickSize(-height).tickFormat(''));

            // Axes
            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x));

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y));

            svg.append('text')
                .attr('class', 'axis-label')
                .attr('x', width / 2)
                .attr('y', height + 40)
                .attr('text-anchor', 'middle')
                .text('CO‚ÇÇ per Capita (tonnes)');

            svg.append('text')
                .attr('class', 'axis-label')
                .attr('transform', 'rotate(-90)')
                .attr('y', -45)
                .attr('x', -height / 2)
                .attr('text-anchor', 'middle')
                .text('Temperature Increase (¬∞C)');

            // Regression line
            const xMean = d3.mean(data, d => d.co2);
            const yMean = d3.mean(data, d => d.tempIncrease);
            const num = d3.sum(data, d => (d.co2 - xMean) * (d.tempIncrease - yMean));
            const den = d3.sum(data, d => Math.pow(d.co2 - xMean, 2));
            const slope = num / den;
            const intercept = yMean - slope * xMean;

            svg.append('line')
                .attr('x1', x(0))
                .attr('y1', y(intercept))
                .attr('x2', x(d3.max(data, d => d.co2)))
                .attr('y2', y(slope * d3.max(data, d => d.co2) + intercept))
                .attr('stroke', '#D62828')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '5,5')
                .attr('opacity', 0.7);

            // Scatter points
            svg.selectAll('.scatter-dot')
                .data(data)
                .enter()
                .append('circle')
                .attr('class', 'scatter-dot')
                .attr('data-country', d => d.country)
                .attr('cx', d => x(d.co2))
                .attr('cy', d => y(d.tempIncrease))
                .attr('r', d => sizeScale(d.population))
                .attr('fill', d => regionColors[d.region])
                .attr('opacity', 0.7)
                .attr('stroke', '#fff')
                .attr('stroke-width', 1.5)
                .on('mouseover', function(event, d) {
                    if (selectedCountries.size === 0) {
                        d3.selectAll('.scatter-dot').classed('dimmed', true);
                        d3.select(this).classed('dimmed', false);
                    }
                    d3.select(this).attr('r', sizeScale(d.population) * 1.5);
                    showTooltip(`<strong>${d.country}</strong>
                        Temp Increase: +${d.tempIncrease.toFixed(2)}¬∞C<br>
                        CO‚ÇÇ: ${d.co2.toFixed(1)} tonnes/capita<br>
                        Population: ${(d.population / 1000000).toFixed(1)}M<br>
                        Region: ${d.region}`, event);
                })
                .on('mouseout', function(event, d) {
                    if (selectedCountries.size === 0) {
                        d3.selectAll('.scatter-dot').classed('dimmed', false);
                    }
                    d3.select(this).attr('r', sizeScale(d.population));
                    hideTooltip();
                })
                .on('click', function(event, d) {
                    handleCountrySelection(d.country);
                });

            // Legend for regions
            const legendData = [
                {region: 'arctic', label: 'Arctic/High-Latitude'},
                {region: 'continental', label: 'Continental Interior'},
                {region: 'other', label: 'Other'}
            ];

            const legend = svg.append('g')
                .attr('transform', `translate(${width - 150}, 10)`);

            legendData.forEach((item, i) => {
                const g = legend.append('g')
                    .attr('transform', `translate(0, ${i * 20})`);

                g.append('circle')
                    .attr('r', 5)
                    .attr('fill', regionColors[item.region]);

                g.append('text')
                    .attr('x', 10)
                    .attr('y', 4)
                    .attr('font-size', '11px')
                    .text(item.label);
            });

            updateHighlighting();
        }

        // Brushing & Linking: Handle country selection
        function handleCountrySelection(country) {
            if (selectedCountries.has(country)) {
                selectedCountries.delete(country);
            } else {
                selectedCountries.add(country);
            }
            updateAllCharts();
            updateSelectionInfo();
        }

        // Update highlighting across all charts
        function updateHighlighting() {
            if (selectedCountries.size === 0) {
                // Reset all
                d3.selectAll('.line, .bar, .scatter-dot, .country-flag')
                    .classed('dimmed', false)
                    .classed('highlighted', false);
            } else {
                // Dim all
                d3.selectAll('.line, .bar, .scatter-dot, .country-flag')
                    .classed('dimmed', true)
                    .classed('highlighted', false);

                // Highlight selected
                selectedCountries.forEach(country => {
                    d3.selectAll(`[data-country="${country}"]`)
                        .classed('dimmed', false)
                        .classed('highlighted', true);
                });
            }
        }

        // Update all charts
        function updateAllCharts() {
            createTimeSeries();
            createBarChart();
            createMap();
            createScatter();
        }

        // Event handlers
        document.getElementById('region-filter').addEventListener('change', function(e) {
            currentRegion = e.target.value;
            selectedCountries.clear();
            updateAllCharts();
            updateSelectionInfo();
        });

        document.getElementById('country-selector').addEventListener('change', function(e) {
            selectedCountries.clear();
            const options = e.target.selectedOptions;
            for (let option of options) {
                selectedCountries.add(option.value);
            }
            updateAllCharts();
            updateSelectionInfo();
        });

        document.getElementById('reset-btn').addEventListener('click', function() {
            selectedCountries.clear();
            currentRegion = 'all';
            document.getElementById('region-filter').value = 'all';
            document.getElementById('country-selector').selectedIndex = -1;
            updateAllCharts();
            updateSelectionInfo();
        });

        // Initialize dashboard
        updateAllCharts();
    </script>
</body>
</html>