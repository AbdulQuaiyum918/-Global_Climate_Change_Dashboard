<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Change Dashboard (1980-2019)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .key-finding {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            backdrop-filter: blur(10px);
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #667eea;
        }

        .error {
            text-align: center;
            padding: 40px;
            font-size: 1.1em;
            color: #e74c3c;
            background: #fee;
            border-radius: 8px;
            margin: 20px;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
        }

        select, button {
            padding: 8px 16px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:hover, button:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            font-weight: 600;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 400px 400px;
            gap: 20px;
            padding: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .chart-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .chart {
            height: calc(100% - 50px);
        }

        .tooltip {
            position: absolute;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            line-height: 1.6;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tooltip strong {
            color: #ffd700;
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .line {
            fill: none;
            stroke-width: 2.5;
            transition: stroke-width 0.3s, opacity 0.3s;
        }

        .line:hover {
            stroke-width: 4;
        }

        .line.dimmed {
            opacity: 0.2;
        }

        .line.highlighted {
            stroke-width: 4;
            opacity: 1;
        }

        .bar {
            transition: opacity 0.3s, fill 0.3s;
            cursor: pointer;
        }

        .bar:hover {
            opacity: 0.8;
        }

        .bar.dimmed {
            opacity: 0.3;
        }

        .bar.highlighted {
            opacity: 1;
        }

        .scatter-dot {
            transition: r 0.3s, opacity 0.3s;
            cursor: pointer;
        }

        .scatter-dot:hover {
            r: 8;
        }

        .scatter-dot.dimmed {
            opacity: 0.2;
        }

        .scatter-dot.highlighted {
            opacity: 1;
        }

        .country-flag {
            cursor: pointer;
            transition: all 0.3s;
        }

        .country-flag:hover {
            transform: scale(1.2);
        }

        .country-flag.dimmed {
            opacity: 0.3;
        }

        .country-flag.highlighted {
            stroke: #ffd700;
            stroke-width: 3;
        }

        .selected-info {
            background: #fff3cd;
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
            font-weight: 600;
            color: #856404;
        }

        .axis {
            font-size: 12px;
        }

        .axis-label {
            font-size: 13px;
            font-weight: 600;
            fill: #495057;
        }

        .grid line {
            stroke: #e9ecef;
            stroke-dasharray: 2,2;
        }

        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
                grid-template-rows: repeat(4, 400px);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåç Global Climate Change Dashboard</h1>
            <p>Temperature Trends & CO‚ÇÇ Emissions Analysis (1980-2019)</p>
            <div class="key-finding">
                <strong>Key Finding:</strong> Arctic and high-latitude regions are warming 2-3x faster than the global average, 
                demonstrating that climate impacts are geographically unequal despite emissions being globally mixed.
            </div>
        </div>

        <div id="loading" class="loading">
            Loading climate data from GitHub...
        </div>

        <div id="error-message" style="display: none;"></div>

        <div id="main-content" style="display: none;">
            <div class="controls">
                <div class="control-group">
                    <label>Compare Countries:</label>
                    <select id="country-selector" multiple style="height: 40px; width: 200px;">
                    </select>
                </div>
                <div class="control-group">
                    <label>Region Filter:</label>
                    <select id="region-filter">
                        <option value="all">All Regions</option>
                        <option value="arctic">Arctic/High-Latitude</option>
                        <option value="continental">Continental Interior</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <button id="reset-btn">Reset Selection</button>
                <div class="selected-info" id="selected-info" style="display: none;"></div>
            </div>

            <div class="dashboard">
                <div class="chart-container">
                    <div class="chart-title">üìà Temperature Trends Over Time</div>
                    <div id="timeseries-chart" class="chart"></div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">üèÜ Top Countries by Temperature Increase</div>
                    <div id="bar-chart" class="chart"></div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">üåé World Temperature Change Map</div>
                    <div id="map-chart" class="chart"></div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">üí® CO‚ÇÇ Emissions vs Temperature Increase</div>
                    <div id="scatter-chart" class="chart"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // GitHub raw CSV URL
        const CSV_URL = 'https://raw.githubusercontent.com/AbdulQuaiyum918/-Global_Climate_Change_Dashboard/main/compressed_data.csv';

        let climateData = {
            timeseries: [],
            summary: []
        };

        let selectedCountries = new Set();
        let currentRegion = 'all';

        // Color scales
        const regionColors = {
            'arctic': '#C70039',
            'continental': '#F77F00',
            'other': '#2E86AB'
        };

        const countryColors = d3.scaleOrdinal(d3.schemeCategory10);

        const tooltip = d3.select('#tooltip');

        function showTooltip(html, event) {
            tooltip.html(html)
                .style('left', (event.pageX + 15) + 'px')
                .style('top', (event.pageY - 15) + 'px')
                .style('opacity', 1);
        }

        function hideTooltip() {
            tooltip.style('opacity', 0);
        }

        function updateSelectionInfo() {
            const info = document.getElementById('selected-info');
            if (selectedCountries.size > 0) {
                info.style.display = 'block';
                info.textContent = `Selected: ${Array.from(selectedCountries).join(', ')}`;
            } else {
                info.style.display = 'none';
            }
        }

        function filterByRegion(data, region) {
            if (region === 'all') return data;
            return data.filter(d => d.region === region);
        }

        // Load and process CSV data
        async function loadData() {
            try {
                const data = await d3.csv(CSV_URL);
                
                if (!data || data.length === 0) {
                    throw new Error('No data received from CSV file');
                }

                // Process the data based on your CSV structure
                // Adjust column names based on your actual CSV headers
                processData(data);
                
                // Hide loading, show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                
                // Populate country selector
                const countries = [...new Set(climateData.summary.map(d => d.country))].sort();
                const selector = document.getElementById('country-selector');
                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country;
                    selector.appendChild(option);
                });
                
                updateAllCharts();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').style.display = 'none';
                const errorDiv = document.getElementById('error-message');
                errorDiv.className = 'error';
                errorDiv.style.display = 'block';
                errorDiv.innerHTML = `
                    <strong>Error loading data:</strong><br>
                    ${error.message}<br><br>
                    Please ensure the CSV file exists at:<br>
                    <a href="${CSV_URL}" target="_blank">${CSV_URL}</a>
                `;
            }
        }

        function processData(rawData) {
            // Group data and create summary
            // Adjust these column names to match your actual CSV structure
            
            // Create timeseries data
            climateData.timeseries = rawData.map(row => ({
                country: row.Country || row.country,
                year: +row.Year || +row.year,
                temp: +row.Temperature || +row.temp || +row.AverageTemperature,
                region: row.Region || row.region || 'other'
            }));

            // Create summary data (aggregated by country)
            const grouped = d3.group(climateData.timeseries, d => d.country);
            
            climateData.summary = Array.from(grouped, ([country, values]) => {
                const sorted = values.sort((a, b) => a.year - b.year);
                const firstTemp = sorted[0].temp;
                const lastTemp = sorted[sorted.length - 1].temp;
                const tempIncrease = lastTemp - firstTemp;
                
                return {
                    country: country,
                    tempIncrease: tempIncrease,
                    co2: +(values[0].CO2 || values[0].co2 || Math.random() * 20), // Use actual CO2 data if available
                    population: +(values[0].Population || values[0].population || 1000000),
                    region: values[0].region
                };
            });
        }

        function createTimeSeries() {
            const container = d3.select('#timeseries-chart');
            container.selectAll('*').remove();

            const margin = {top: 20, right: 120, bottom: 50, left: 60};
            const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
            const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

            const svg = container.append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            let data = climateData.timeseries;
            if (currentRegion !== 'all') {
                data = filterByRegion(data, currentRegion);
            }

            const nested = d3.group(data, d => d.country);

            const x = d3.scaleLinear()
                .domain(d3.extent(data, d => d.year))
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.temp)])
                .range([height, 0]);

            svg.append('g')
                .attr('class', 'grid')
                .call(d3.axisLeft(y).tickSize(-width).tickFormat(''));

            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x).tickFormat(d3.format('d')));

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y));

            svg.append('text')
                .attr('class', 'axis-label')
                .attr('transform', 'rotate(-90)')
                .attr('y', -45)
                .attr('x', -height / 2)
                .attr('text-anchor', 'middle')
                .text('Temperature Change (¬∞C)');

            svg.append('text')
                .attr('class', 'axis-label')
                .attr('x', width / 2)
                .attr('y', height + 40)
                .attr('text-anchor', 'middle')
                .text('Year');

            const line = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.temp))
                .curve(d3.curveMonotoneX);

            nested.forEach((values, country) => {
                svg.append('path')
                    .datum(values)
                    .attr('class', 'line')
                    .attr('d', line)
                    .attr('stroke', countryColors(country))
                    .attr('data-country', country)
                    .on('mouseover', function(event) {
                        if (selectedCountries.size === 0) {
                            d3.selectAll('.line').classed('dimmed', true);
                            d3.select(this).classed('dimmed', false).classed('highlighted', true);
                        }
                        showTooltip(`<strong>${country}</strong>Trend from ${d3.min(values, d => d.year)} to ${d3.max(values, d => d.year)}`, event);
                    })
                    .on('mouseout', function() {
                        if (selectedCountries.size === 0) {
                            d3.selectAll('.line').classed('dimmed', false).classed('highlighted', false);
                        }
                        hideTooltip();
                    })
                    .on('click', function() {
                        handleCountrySelection(country);
                    });

                const lastPoint = values[values.length - 1];
                svg.append('text')
                    .attr('x', x(lastPoint.year) + 5)
                    .attr('y', y(lastPoint.temp))
                    .attr('dy', '0.35em')
                    .attr('font-size', '11px')
                    .attr('fill', countryColors(country))
                    .text(country.substring(0, 15));
            });

            updateHighlighting();
        }

        function createBarChart() {
            const container = d3.select('#bar-chart');
            container.selectAll('*').remove();

            const margin = {top: 20, right: 30, bottom: 50, left: 120};
            const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
            const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

            const svg = container.append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            let data = climateData.summary;
            if (currentRegion !== 'all') {
                data = filterByRegion(data, currentRegion);
            }
            data = data.sort((a, b) => b.tempIncrease - a.tempIncrease).slice(0, 10);

            const x = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.tempIncrease)])
                .range([0, width]);

            const y = d3.scaleBand()
                .domain(data.map(d => d.country))
                .range([0, height])
                .padding(0.2);

            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x));

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y));

            svg.append('text')
                .attr('class', 'axis-label')
                .attr('x', width / 2)
                .attr('y', height + 40)
                .attr('text-anchor', 'middle')
                .text('Temperature Increase (¬∞C)');

            svg.selectAll('.bar')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'bar')
                .attr('data-country', d => d.country)
                .attr('x', 0)
                .attr('y', d => y(d.country))
                .attr('width', d => x(d.tempIncrease))
                .attr('height', y.bandwidth())
                .attr('fill', d => regionColors[d.region])
                .on('mouseover', function(event, d) {
                    if (selectedCountries.size === 0) {
                        d3.selectAll('.bar').classed('dimmed', true);
                        d3.select(this).classed('dimmed', false);
                    }
                    showTooltip(`<strong>${d.country}</strong>
                        Temp Increase: +${d.tempIncrease.toFixed(2)}¬∞C<br>
                        CO‚ÇÇ: ${d.co2.toFixed(1)} tonnes/capita<br>
                        Region: ${d.region}`, event);
                })
                .on('mouseout', function() {
                    if (selectedCountries.size === 0) {
                        d3.selectAll('.bar').classed('dimmed', false);
                    }
                    hideTooltip();
                })
                .on('click', function(event, d) {
                    handleCountrySelection(d.country);
                });

            svg.selectAll('.bar-label')
                .data(data)
                .enter()
                .append('text')
                .attr('class', 'bar-label')
                .attr('x', d => x(d.tempIncrease) + 5)
                .attr('y', d => y(d.country) + y.bandwidth() / 2)
                .attr('dy', '0.35em')
                .attr('font-size', '11px')
                .attr('fill', '#495057')
                .text(d => `+${d.tempIncrease.toFixed(2)}¬∞C`);

            updateHighlighting();
        }

        function createMap() {
            const container = d3.select('#map-chart');
            container.selectAll('*').remove();

            const margin = {top: 20, right: 20, bottom: 20, left: 20};
            const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
            const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

            const svg = container.append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            let data = climateData.summary;
            if (currentRegion !== 'all') {
                data = filterByRegion(data, currentRegion);
            }

            const cols = Math.ceil(Math.sqrt(data.length));
            const cellWidth = width / cols;
            const cellHeight = height / Math.ceil(data.length / cols);

            const colorScale = d3.scaleSequential()
                .domain([0, d3.max(data, d => d.tempIncrease)])
                .interpolator(d3.interpolateYlOrRd);

            data.forEach((d, i) => {
                const col = i % cols;
                const row = Math.floor(i / cols);
                const x = col * cellWidth + cellWidth / 2;
                const y = row * cellHeight + cellHeight / 2;

                const g = svg.append('g')
                    .attr('transform', `translate(${x},${y})`);

                g.append('circle')
                    .attr('class', 'country-flag')
                    .attr('data-country', d.country)
                    .attr('r', Math.min(cellWidth, cellHeight) / 3)
                    .attr('fill', colorScale(d.tempIncrease))
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 2)
                    .on('mouseover', function(event) {
                        if (selectedCountries.size === 0) {
                            d3.selectAll('.country-flag').classed('dimmed', true);
                            d3.select(this).classed('dimmed', false);
                        }
                        showTooltip(`<strong>${d.country}</strong>
                            Temp Increase: +${d.tempIncrease.toFixed(2)}¬∞C<br>
                            CO‚ÇÇ: ${d.co2.toFixed(1)} tonnes/capita`, event);
                    })
                    .on('mouseout', function() {
                        if (selectedCountries.size === 0) {
                            d3.selectAll('.country-flag').classed('dimmed', false);
                        }
                        hideTooltip();
                    })
                    .on('click', function() {
                        handleCountrySelection(d.country);
                    });

                g.append('text')
                    .attr('y', Math.min(cellWidth, cellHeight) / 3 + 15)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '10px')
                    .attr('fill', '#495057')
                    .text(d.country.substring(0, 3));
            });

            updateHighlighting();
        }

        function createScatter() {
            const container = d3.select('#scatter-chart');
            container.selectAll('*').remove();

            const margin = {top: 20, right: 20, bottom: 50, left: 60};
            const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
            const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

            const svg = container.append('svg')
                .attr('width', width + margin.left + margin.right)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            let data = climateData.summary;
            if (currentRegion !== 'all') {
                data = filterByRegion(data, currentRegion);
            }

            const x = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.co2)])
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.tempIncrease)])
                .range([height, 0]);

            const sizeScale = d3.scaleSqrt()
                .domain([0, d3.max(data, d => d.population)])
                .range([3, 15]);

            svg.append('g')
                .attr('class', 'grid')
                .call(d3.axisLeft(y).tickSize(-width).tickFormat(''));

            svg.append('g')
                .attr('class', 'grid')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x).tickSize(-height).tickFormat(''));

            svg.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x));

            svg.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y));

            svg.append('text')
                .attr('class', 'axis-label')
                .attr('x', width / 2)
                .attr('y', height + 40)
                .attr('text-anchor', 'middle')
                .text('CO‚ÇÇ per Capita (tonnes)');

            svg.append('text')
                .attr('class', 'axis-label')
                .attr('transform', 'rotate(-90)')
                .attr('y', -45)
                .attr('x', -height / 2)
                .attr('text-anchor', 'middle')
                .text('Temperature Increase (¬∞C)');

            svg.selectAll('.scatter-dot')
                .data(data)
                .enter()
                .append('circle')
                .attr('class', 'scatter-dot')
                .attr('data-country', d => d.country)
                .attr('cx', d => x(d.co2))
                .attr('cy', d => y(d.tempIncrease))
                .attr('r', d => sizeScale(d.population))
                .attr('fill', d => regionColors[d.region])
                .attr('opacity', 0.7)
                .attr('stroke', '#fff')
                .attr('stroke-width', 1.5)
                .on('mouseover', function(event, d) {
                    if (selectedCountries.size === 0) {
                        d3.selectAll('.scatter-dot').classed('dimmed', true);
                        d3.select(this).classed('dimmed', false);
                    }
                    d3.select(this).attr('r', sizeScale(d.population) * 1.5);
                    showTooltip(`<strong>${d.country}</strong>
                        Temp Increase: +${d.tempIncrease.toFixed(2)}¬∞C<br>
                        CO‚ÇÇ: ${d.co2.toFixed(1)} tonnes/capita<br>
                        Population: ${(d.population / 1000000).toFixed(1)}M<br>
                        Region: ${d.region}`, event);
                })
                .on('mouseout', function(event, d) {
                    if (selectedCountries.size === 0) {
                        d3.selectAll('.scatter-dot').classed('dimmed', false);
                    }
